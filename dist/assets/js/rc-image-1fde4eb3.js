import{c as Ge,h as be,e as Z,g as Re,b as J,f as te}from"./@babel-25fffde3.js";import{r,e as ge}from"./react-0fb5d424.js";import{c as ae}from"./classnames-fe2c27d8.js";import{A as _e,j as Qe,G as Ve,K as Fe,D as Se,H as er}from"./rc-util-48ba7f71.js";import{D as rr}from"./rc-dialog-fa40b945.js";import{C as tr}from"./rc-motion-eb90ae56.js";import{P as nr}from"./@rc-component-ed6c637d.js";var or=["visible","onVisibleChange","getContainer","current","countRender","onChange"],Ye=r.createContext({previewUrls:new Map,setPreviewUrls:function(){return null},current:null,setCurrent:function(){return null},setShowPreview:function(){return null},setMousePosition:function(){return null},registerImage:function(){return function(){return null}},rootClassName:""}),ar=Ye.Provider;function Te(u,e){if(e!==void 0){var n=u.indexOf(e);if(n!==-1)return n}}var ir=function(e){var n=e.previewPrefixCls,p=n===void 0?"rc-image-preview":n,S=e.children,a=e.icons,o=a===void 0?{}:a,v=e.preview,s=Ge(v)==="object"?v:{},Y=s.visible,b=Y===void 0?void 0:Y,y=s.onVisibleChange,d=y===void 0?void 0:y,l=s.getContainer,C=l===void 0?void 0:l,D=s.current,$=D===void 0?0:D,z=s.countRender,A=z===void 0?void 0:z,k=s.onChange,I=k===void 0?void 0:k,G=be(s,or),w=r.useState(new Map),X=Z(w,2),V=X[0],R=X[1],L=Array.from(V.keys()),U=r.useRef(),W=_e(void 0,{onChange:function(c,M){U.current!==void 0&&(I==null||I(Te(L,c),Te(L,M))),U.current=M}}),T=Z(W,2),h=T[0],x=T[1],m=_e(!!b,{value:b,onChange:function(c,M){d==null||d(c,M,Te(L,h)),U.current=c?h:void 0}}),P=Z(m,2),N=P[0],H=P[1],_=r.useState(null),i=Z(_,2),F=i[0],g=i[1],K=b!==void 0,E=L[$],O=new Map(Array.from(V).filter(function(j){var c=Z(j,2),M=c[1].canPreview;return!!M}).map(function(j){var c=Z(j,2),M=c[0],ie=c[1].url;return[M,ie]})),pe=function(c,M){var ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,ve=function(){R(function(le){var de=new Map(le),ce=de.delete(c);return ce?de:le})};return R(function(se){return new Map(se).set(c,{url:M,canPreview:ie})}),ve},Ce=function(c){c.stopPropagation(),H(!1),g(null)};return r.useEffect(function(){x(E)},[E]),r.useEffect(function(){!N&&K&&x(E)},[E,K,N]),r.createElement(ar,{value:{isPreviewGroup:!0,previewUrls:O,setPreviewUrls:R,current:h,setCurrent:x,setShowPreview:H,setMousePosition:g,registerImage:pe}},S,r.createElement(We,Re({"aria-hidden":!N,visible:N,prefixCls:p,onClose:Ce,mousePosition:F,src:O.get(h),icons:o,getContainer:C,countRender:A},G)))},xe=1,Ne=50,ye=1,sr=1,lr=function(e){var n,p=e.visible,S=e.maskTransitionName,a=e.getContainer,o=e.prefixCls,v=e.rootClassName,s=e.icons,Y=e.countRender,b=e.showSwitch,y=e.showProgress,d=e.current,l=e.count,C=e.scale,D=e.onSwitchLeft,$=e.onSwitchRight,z=e.onClose,A=e.onZoomIn,k=e.onZoomOut,I=e.onRotateRight,G=e.onRotateLeft,w=e.onFlipX,X=e.onFlipY,V=s.rotateLeft,R=s.rotateRight,L=s.zoomIn,U=s.zoomOut,W=s.close,T=s.left,h=s.right,x=s.flipX,m=s.flipY,P="".concat(o,"-operations-operation"),N="".concat(o,"-operations-icon"),H=[{icon:W,onClick:z,type:"close"},{icon:L,onClick:A,type:"zoomIn",disabled:C===Ne},{icon:U,onClick:k,type:"zoomOut",disabled:C===xe},{icon:R,onClick:I,type:"rotateRight"},{icon:V,onClick:G,type:"rotateLeft"},{icon:x,onClick:w,type:"flipX"},{icon:m,onClick:X,type:"flipY"}],_=r.createElement(r.Fragment,null,b&&r.createElement(r.Fragment,null,r.createElement("div",{className:ae("".concat(o,"-switch-left"),J({},"".concat(o,"-switch-left-disabled"),d===0)),onClick:D},T),r.createElement("div",{className:ae("".concat(o,"-switch-right"),J({},"".concat(o,"-switch-right-disabled"),d===l-1)),onClick:$},h)),r.createElement("ul",{className:"".concat(o,"-operations")},y&&r.createElement("li",{className:"".concat(o,"-operations-progress")},(n=Y==null?void 0:Y(d+1,l))!==null&&n!==void 0?n:"".concat(d+1," / ").concat(l)),H.map(function(i){var F,g=i.icon,K=i.onClick,E=i.type,O=i.disabled;return r.createElement("li",{className:ae(P,(F={},J(F,"".concat(o,"-operations-operation-").concat(E),!0),J(F,"".concat(o,"-operations-operation-disabled"),!!O),F)),onClick:K,key:E},r.isValidElement(g)?r.cloneElement(g,{className:N}):g)})));return r.createElement(tr,{visible:p,motionName:S},function(i){var F=i.className,g=i.style;return r.createElement(nr,{open:!0,getContainer:a??document.body},r.createElement("div",{className:ae("".concat(o,"-operations-wrapper"),F,v),style:g},_))})},Ze={x:0,y:0,rotate:0,scale:1,flipX:!1,flipY:!1};function cr(u){var e=r.useRef(null),n=r.useRef([]),p=r.useState(Ze),S=Z(p,2),a=S[0],o=S[1],v=function(){o(Ze)},s=function(y){e.current===null&&(n.current=[],e.current=Qe(function(){o(function(d){var l=d;return n.current.forEach(function(C){l=te(te({},l),C)}),e.current=null,l})})),n.current.push(te(te({},a),y))},Y=function(y,d,l){var C=u.current,D=C.width,$=C.height,z=C.offsetWidth,A=C.offsetHeight,k=C.offsetLeft,I=C.offsetTop,G=y,w=a.scale*y;w>Ne?(G=Ne/a.scale,w=Ne):w<xe&&(G=xe/a.scale,w=xe);var X=d??innerWidth/2,V=l??innerHeight/2,R=G-1,L=R*D*.5,U=R*$*.5,W=R*(X-a.x-k),T=R*(V-a.y-I),h=a.x-(W-L),x=a.y-(T-U);if(y<1&&w===1){var m=z*w,P=A*w,N=Ve(),H=N.width,_=N.height;m<=H&&P<=_&&(h=0,x=0)}s({x:h,y:x,scale:w})};return{transform:a,resetTransform:v,updateTransform:s,dispatchZoomChange:Y}}function De(u,e,n,p){var S=e+n,a=(n-p)/2;if(n>p){if(e>0)return J({},u,a);if(e<0&&S<p)return J({},u,-a)}else if(e<0||S>p)return J({},u,e<0?a:-a);return{}}function ur(u,e,n,p){var S=Ve(),a=S.width,o=S.height,v=null;return u<=a&&e<=o?v={x:0,y:0}:(u>a||e>o)&&(v=te(te({},De("x",n,u,a)),De("y",p,e,o))),v}var fr=["prefixCls","src","alt","onClose","visible","icons","rootClassName","getContainer","countRender","scaleStep","transitionName","maskTransitionName"],We=function(e){var n=e.prefixCls,p=e.src,S=e.alt,a=e.onClose,o=e.visible,v=e.icons,s=v===void 0?{}:v,Y=e.rootClassName,b=e.getContainer,y=e.countRender,d=e.scaleStep,l=d===void 0?.5:d,C=e.transitionName,D=C===void 0?"zoom":C,$=e.maskTransitionName,z=$===void 0?"fade":$,A=be(e,fr),k=r.useRef(),I=r.useRef({deltaX:0,deltaY:0,transformX:0,transformY:0}),G=r.useState(!1),w=Z(G,2),X=w[0],V=w[1],R=r.useContext(Ye),L=R.previewUrls,U=R.current,W=R.isPreviewGroup,T=R.setCurrent,h=L.size,x=Array.from(L.keys()),m=x.indexOf(U),P=W?L.get(U):p,N=W&&h>1,H=W&&h>=1,_=cr(k),i=_.transform,F=_.resetTransform,g=_.updateTransform,K=_.dispatchZoomChange,E=i.rotate,O=i.scale,pe=ae(J({},"".concat(n,"-moving"),X)),Ce=function(){F()},j=function(){K(ye+l)},c=function(){K(ye-l)},M=function(){g({rotate:E+90})},ie=function(){g({rotate:E-90})},ve=function(){g({flipX:!i.flipX})},se=function(){g({flipY:!i.flipY})},le=function(t){t.preventDefault(),t.stopPropagation(),m>0&&T(x[m-1])},de=function(t){t.preventDefault(),t.stopPropagation(),m<h-1&&T(x[m+1])},ce=function(){if(o&&X){V(!1);var t=I.current,q=t.transformX,Q=t.transformY,ee=i.x!==q&&i.y!==Q;if(!ee)return;var re=k.current.offsetWidth*O,ne=k.current.offsetHeight*O,Pe=k.current.getBoundingClientRect(),ke=Pe.left,Ie=Pe.top,me=E%180!==0,oe=ur(me?ne:re,me?re:ne,ke,Ie);oe&&g(te({},oe))}},we=function(t){t.button===0&&(t.preventDefault(),t.stopPropagation(),I.current={deltaX:t.pageX-i.x,deltaY:t.pageY-i.y,transformX:i.x,transformY:i.y},V(!0))},ue=function(t){o&&X&&g({x:t.pageX-I.current.deltaX,y:t.pageY-I.current.deltaY})},Ee=function(t){if(!(!o||t.deltaY==0)){var q=Math.abs(t.deltaY/100),Q=Math.min(q,sr),ee=ye+Q*l;t.deltaY>0&&(ee=ye/ee),K(ee,t.clientX,t.clientY)}},he=r.useCallback(function(f){!o||!N||(f.keyCode===Fe.LEFT?m>0&&T(x[m-1]):f.keyCode===Fe.RIGHT&&m<h-1&&T(x[m+1]))},[m,h,x,T,N,o]),Me=function(t){o&&(O!==1?g({x:0,y:0,scale:1}):K(ye+l,t.clientX,t.clientY))};return r.useEffect(function(){var f,t,q=Se(window,"mouseup",ce,!1),Q=Se(window,"mousemove",ue,!1),ee=Se(window,"keydown",he,!1);try{window.top!==window.self&&(f=Se(window.top,"mouseup",ce,!1),t=Se(window.top,"mousemove",ue,!1))}catch{}return function(){var re,ne;q.remove(),Q.remove(),ee.remove(),(re=f)===null||re===void 0||re.remove(),(ne=t)===null||ne===void 0||ne.remove()}},[o,X,he]),ge.createElement(ge.Fragment,null,ge.createElement(rr,Re({transitionName:D,maskTransitionName:z,closable:!1,keyboard:!0,prefixCls:n,onClose:a,visible:o,wrapClassName:pe,rootClassName:Y,getContainer:b},A,{afterClose:Ce}),ge.createElement("div",{className:"".concat(n,"-img-wrapper")},ge.createElement("img",{width:e.width,height:e.height,onWheel:Ee,onMouseDown:we,onDoubleClick:Me,ref:k,className:"".concat(n,"-img"),src:P,alt:S,style:{transform:"translate3d(".concat(i.x,"px, ").concat(i.y,"px, 0) scale3d(").concat(i.flipX?"-":"").concat(O,", ").concat(i.flipY?"-":"").concat(O,", 1) rotate(").concat(E,"deg)")}}))),ge.createElement(lr,{visible:o,maskTransitionName:z,getContainer:b,prefixCls:n,rootClassName:Y,icons:s,countRender:y,showSwitch:N,showProgress:H,current:m,count:h,scale:O,onSwitchLeft:le,onSwitchRight:de,onZoomIn:j,onZoomOut:c,onRotateRight:M,onRotateLeft:ie,onFlipX:ve,onFlipY:se,onClose:a}))},vr=["src","alt","onPreviewClose","prefixCls","previewPrefixCls","placeholder","fallback","width","height","style","preview","className","onClick","onError","wrapperClassName","wrapperStyle","rootClassName","crossOrigin","decoding","loading","referrerPolicy","sizes","srcSet","useMap","draggable"],dr=["src","visible","onVisibleChange","getContainer","mask","maskClassName","icons","scaleStep"],ze=0;function mr(u){return new Promise(function(e){var n=document.createElement("img");n.onerror=function(){return e(!1)},n.onload=function(){return e(!0)},n.src=u})}var He=function(e){var n,p=e.src,S=e.alt,a=e.onPreviewClose,o=e.prefixCls,v=o===void 0?"rc-image":o,s=e.previewPrefixCls,Y=s===void 0?"".concat(v,"-preview"):s,b=e.placeholder,y=e.fallback,d=e.width,l=e.height,C=e.style,D=e.preview,$=D===void 0?!0:D,z=e.className,A=e.onClick,k=e.onError,I=e.wrapperClassName,G=e.wrapperStyle,w=e.rootClassName,X=e.crossOrigin,V=e.decoding,R=e.loading,L=e.referrerPolicy,U=e.sizes,W=e.srcSet,T=e.useMap,h=e.draggable,x=be(e,vr),m=b&&b!==!0,P=Ge($)==="object"?$:{},N=P.src,H=P.visible,_=H===void 0?void 0:H,i=P.onVisibleChange,F=i===void 0?a:i,g=P.getContainer,K=g===void 0?void 0:g,E=P.mask,O=P.maskClassName,pe=P.icons,Ce=P.scaleStep,j=be(P,dr),c=N??p,M=_!==void 0,ie=_e(!!_,{value:_,onChange:F}),ve=Z(ie,2),se=ve[0],le=ve[1],de=r.useState(m?"loading":"normal"),ce=Z(de,2),we=ce[0],ue=ce[1],Ee=r.useState(null),he=Z(Ee,2),Me=he[0],f=he[1],t=we==="error",q=r.useContext(Ye),Q=q.isPreviewGroup,ee=q.setCurrent,re=q.setShowPreview,ne=q.setMousePosition,Pe=q.registerImage,ke=r.useState(function(){return ze+=1,ze}),Ie=Z(ke,1),me=Ie[0],oe=!!$,Le=r.useRef(!1),Xe=function(){ue("normal")},Ke=function(B){if(!M){var $e=er(B.target),Ae=$e.left,Ue=$e.top;Q?(ee(me),ne({x:Ae,y:Ue})):f({x:Ae,y:Ue})}Q?re(!0):le(!0),A==null||A(B)},je=function(B){B.stopPropagation(),le(!1),M||f(null)},qe=function(B){Le.current=!1,we==="loading"&&B!=null&&B.complete&&(B.naturalWidth||B.naturalHeight)&&(Le.current=!0,Xe())};r.useEffect(function(){mr(c).then(function(fe){fe||ue("error")})},[c]),r.useEffect(function(){var fe=Pe(me,c);return fe},[]),r.useEffect(function(){Pe(me,c,oe)},[c,oe]),r.useEffect(function(){t&&ue("normal"),m&&!Le.current&&ue("loading")},[p]);var Be=ae(v,I,w,J({},"".concat(v,"-error"),t)),Je=t&&y?y:c,Oe={crossOrigin:X,decoding:V,draggable:h,loading:R,referrerPolicy:L,sizes:U,srcSet:W,useMap:T,onError:k,alt:S,className:ae("".concat(v,"-img"),J({},"".concat(v,"-img-placeholder"),b===!0),z),style:te({height:l},C)};return r.createElement(r.Fragment,null,r.createElement("div",Re({},x,{className:Be,onClick:oe?Ke:A,style:te({width:d,height:l},G)}),r.createElement("img",Re({},Oe,{ref:qe},t&&y?{src:y}:{onLoad:Xe,src:p},{width:d,height:l})),we==="loading"&&r.createElement("div",{"aria-hidden":"true",className:"".concat(v,"-placeholder")},b),E&&oe&&r.createElement("div",{className:ae("".concat(v,"-mask"),O),style:{display:((n=Oe.style)===null||n===void 0?void 0:n.display)==="none"?"none":void 0}},E)),!Q&&oe&&r.createElement(We,Re({"aria-hidden":!se,visible:se,prefixCls:Y,onClose:je,mousePosition:Me,src:Je,alt:S,getContainer:K,icons:pe,scaleStep:Ce,rootClassName:w},j)))};He.PreviewGroup=ir;He.displayName="Image";export{He as I};
