import{b as y,g as ne,h as We,e as F,c as Ae}from"./@babel-25fffde3.js";import{r as t}from"./react-0fb5d424.js";import{c as ae}from"./classnames-fe2c27d8.js";import{I as je,a as Je,j as Ee,J as Z,k as Ye,K as L}from"./rc-util-48ba7f71.js";import{n as De,t as Re,c as S,d as ye,v as ze,e as ee}from"./@rc-component-ed6c637d.js";var Ge=200,Qe=600;function Xe(e){var c=e.prefixCls,o=e.upNode,C=e.downNode,d=e.upDisabled,v=e.downDisabled,p=e.onStep,f=t.useRef(),m=t.useRef();m.current=p;var g=function(R,_){R.preventDefault(),m.current(_);function O(){m.current(_),f.current=setTimeout(O,Ge)}f.current=setTimeout(O,Qe)},l=function(){clearTimeout(f.current)};t.useEffect(function(){return l},[]);var N=je();if(N)return null;var s="".concat(c,"-handler"),E=ae(s,"".concat(s,"-up"),y({},"".concat(s,"-up-disabled"),d)),x=ae(s,"".concat(s,"-down"),y({},"".concat(s,"-down-disabled"),v)),k={unselectable:"on",role:"button",onMouseUp:l,onMouseLeave:l};return t.createElement("div",{className:"".concat(s,"-wrap")},t.createElement("span",ne({},k,{onMouseDown:function(R){g(R,!0)},"aria-label":"Increase Value","aria-disabled":d,className:E}),o||t.createElement("span",{unselectable:"on",className:"".concat(c,"-handler-up-inner")})),t.createElement("span",ne({},k,{onMouseDown:function(R){g(R,!1)},"aria-label":"Decrease Value","aria-disabled":v,className:x}),C||t.createElement("span",{unselectable:"on",className:"".concat(c,"-handler-down-inner")})))}function Ce(e){var c=typeof e=="number"?De(e):Re(e).fullStr,o=c.includes(".");return o?Re(c.replace(/(\d)\.(\d)/g,"$1$2.")).fullStr:e+"0"}function Ze(e,c){var o=t.useRef(null);function C(){try{var v=e.selectionStart,p=e.selectionEnd,f=e.value,m=f.substring(0,v),g=f.substring(p);o.current={start:v,end:p,value:f,beforeTxt:m,afterTxt:g}}catch{}}function d(){if(e&&o.current&&c)try{var v=e.value,p=o.current,f=p.beforeTxt,m=p.afterTxt,g=p.start,l=v.length;if(v.endsWith(m))l=v.length-o.current.afterTxt.length;else if(v.startsWith(f))l=f.length;else{var N=f[g-1],s=v.indexOf(N,g-1);s!==-1&&(l=s+1)}e.setSelectionRange(l,l)}catch(E){Je(!1,"Something warning of cursor restore. Please fire issue about this: ".concat(E.message))}}return[C,d]}const en=function(){var e=t.useRef(0),c=function(){Ee.cancel(e.current)};return t.useEffect(function(){return c},[]),function(o){c(),e.current=Ee(function(){o()})}};var nn=["prefixCls","className","style","min","max","step","defaultValue","value","disabled","readOnly","upHandler","downHandler","keyboard","controls","stringMode","parser","formatter","precision","decimalSeparator","onChange","onInput","onPressEnter","onStep"],he=function(c,o){return c||o.isEmpty()?o.toString():o.toNumber()},we=function(c){var o=S(c);return o.isInvalidate()?null:o},an=t.forwardRef(function(e,c){var o,C=e.prefixCls,d=C===void 0?"rc-input-number":C,v=e.className,p=e.style,f=e.min,m=e.max,g=e.step,l=g===void 0?1:g,N=e.defaultValue,s=e.value,E=e.disabled,x=e.readOnly,k=e.upHandler,M=e.downHandler,R=e.keyboard,_=e.controls,O=_===void 0?!0:_,re=e.stringMode,q=e.parser,U=e.formatter,h=e.precision,w=e.decimalSeparator,W=e.onChange,A=e.onInput,j=e.onPressEnter,J=e.onStep,Ve=We(e,nn),te="".concat(d,"-input"),B=t.useRef(null),xe=t.useState(!1),ue=F(xe,2),oe=ue[0],ie=ue[1],I=t.useRef(!1),K=t.useRef(!1),P=t.useRef(!1),Me=t.useState(function(){return S(s??N)}),se=F(Me,2),i=se[0],le=se[1];function _e(a){s===void 0&&le(a)}var Y=t.useCallback(function(a,n){if(!n)return h>=0?h:Math.max(ye(a),ye(l))},[h,l]),z=t.useCallback(function(a){var n=String(a);if(q)return q(n);var u=n;return w&&(u=u.replace(w,".")),u.replace(/[^\w.-]+/g,"")},[q,w]),ce=t.useRef(""),fe=t.useCallback(function(a,n){if(U)return U(a,{userTyping:n,input:String(ce.current)});var u=typeof a=="number"?De(a):a;if(!n){var r=Y(u,n);if(ze(u)&&(w||r>=0)){var b=w||".";u=ee(u,b,r)}}return u},[U,Y,w]),Ue=t.useState(function(){var a=N??s;return i.isInvalidate()&&["string","number"].includes(Ae(a))?Number.isNaN(a)?"":a:fe(i.toString(),!1)}),de=F(Ue,2),$=de[0],ve=de[1];ce.current=$;function T(a,n){ve(fe(a.isInvalidate()?a.toString(!1):a.toString(!n),n))}var D=t.useMemo(function(){return we(m)},[m,h]),V=t.useMemo(function(){return we(f)},[f,h]),me=t.useMemo(function(){return!D||!i||i.isInvalidate()?!1:D.lessEquals(i)},[D,i]),pe=t.useMemo(function(){return!V||!i||i.isInvalidate()?!1:i.lessEquals(V)},[V,i]),Ke=Ze(B.current,oe),ge=F(Ke,2),Pe=ge[0],$e=ge[1],be=function(n){return D&&!n.lessEquals(D)?D:V&&!V.lessEquals(n)?V:null},G=function(n){return!be(n)},Q=function(n,u){var r=n,b=G(r)||r.isEmpty();if(!r.isEmpty()&&!u&&(r=be(r)||r,b=!0),!x&&!E&&b){var H=r.toString(),X=Y(H,u);return X>=0&&(r=S(ee(H,".",X)),G(r)||(r=S(ee(H,".",X,!0)))),r.equals(i)||(_e(r),W==null||W(r.isEmpty()?null:he(re,r)),s===void 0&&T(r,u)),r}return i},Te=en(),Se=function a(n){if(Pe(),ve(n),!K.current){var u=z(n),r=S(u);r.isNaN()||Q(r,!0)}A==null||A(n),Te(function(){var b=n;q||(b=n.replace(/ã€‚/g,".")),b!==n&&a(b)})},He=function(){K.current=!0},ke=function(){K.current=!1,Se(B.current.value)},Oe=function(n){Se(n.target.value)},Ne=function(n){var u;if(!(n&&me||!n&&pe)){I.current=!1;var r=S(P.current?Ce(l):l);n||(r=r.negate());var b=(i||S(0)).add(r.toString()),H=Q(b,!1);J==null||J(he(re,H),{offset:P.current?Ce(l):l,type:n?"up":"down"}),(u=B.current)===null||u===void 0||u.focus()}},Ie=function(n){var u=S(z($)),r=u;u.isNaN()?r=i:r=Q(u,n),s!==void 0?T(i,!1):r.isNaN()||T(r,!1)},qe=function(){I.current=!0},Be=function(n){var u=n.which,r=n.shiftKey;I.current=!0,r?P.current=!0:P.current=!1,u===L.ENTER&&(K.current||(I.current=!1),Ie(!1),j==null||j(n)),R!==!1&&!K.current&&[L.UP,L.DOWN].includes(u)&&(Ne(L.UP===u),n.preventDefault())},Fe=function(){I.current=!1,P.current=!1},Le=function(){Ie(!1),ie(!1),I.current=!1};return Z(function(){i.isInvalidate()||T(i,!1)},[h]),Z(function(){var a=S(s);le(a);var n=S(z($));(!a.equals(n)||!I.current||U)&&T(a,I.current)},[s]),Z(function(){U&&$e()},[$]),t.createElement("div",{className:ae(d,v,(o={},y(o,"".concat(d,"-focused"),oe),y(o,"".concat(d,"-disabled"),E),y(o,"".concat(d,"-readonly"),x),y(o,"".concat(d,"-not-a-number"),i.isNaN()),y(o,"".concat(d,"-out-of-range"),!i.isInvalidate()&&!G(i)),o)),style:p,onFocus:function(){ie(!0)},onBlur:Le,onKeyDown:Be,onKeyUp:Fe,onCompositionStart:He,onCompositionEnd:ke,onBeforeInput:qe},O&&t.createElement(Xe,{prefixCls:d,upNode:k,downNode:M,upDisabled:me,downDisabled:pe,onStep:Ne}),t.createElement("div",{className:"".concat(te,"-wrap")},t.createElement("input",ne({autoComplete:"off",role:"spinbutton","aria-valuemin":f,"aria-valuemax":m,"aria-valuenow":i.isInvalidate()?null:i.toString(),step:l},Ve,{ref:Ye(B,c),className:te,value:$,onChange:Oe,disabled:E,readOnly:x}))))});an.displayName="InputNumber";export{an as I};
